---
import BaseLayout from '../layouts/BaseLayout.astro';
import { parseOpenAPI, getMethodColor } from '../lib/openapi';

const endpoints = parseOpenAPI();
---

<BaseLayout title="API Reference" description="Complete API documentation for ZK-ID with code examples">
  <div class="container">
    <header class="api-header">
      <h1>API Reference</h1>
      <p class="api-subtitle">
        RESTful API for privacy-preserving identity verification with zero-knowledge proofs
      </p>
    </header>

    <div class="api-intro">
      <h2>Base URL</h2>
      <code class="base-url">http://localhost:3000</code>

      <h2 style="margin-top: 32px;">Protocol Version</h2>
      <p>
        All requests should include the <code>X-ZkId-Protocol-Version</code> header with value <code>zk-id/1.0-draft</code>.
        The SDK handles this automatically.
      </p>
    </div>

    <div class="endpoints">
      {endpoints.map(endpoint => (
        <section class="endpoint" id={endpoint.path.replace(/\//g, '-').substring(1)}>
          <div class="endpoint-header">
            <span class="method-badge" style={`background-color: ${getMethodColor(endpoint.method)}20; color: ${getMethodColor(endpoint.method)}; border-color: ${getMethodColor(endpoint.method)}40;`}>
              {endpoint.method}
            </span>
            <code class="endpoint-path">{endpoint.path}</code>
          </div>

          <p class="endpoint-summary">{endpoint.summary}</p>

          {endpoint.description && (
            <div class="endpoint-description" set:html={endpoint.description} />
          )}

          <div class="code-examples">
            <h3>Code Examples</h3>
            <div class="tabs">
              <button class="tab-button active" data-lang="typescript">TypeScript</button>
              <button class="tab-button" data-lang="python">Python</button>
              <button class="tab-button" data-lang="go">Go</button>
            </div>
            <div class="tab-content">
              <div class="tab-pane active" data-lang="typescript">
                <pre><code>// TypeScript example for {endpoint.path}
// Coming soon - check back later for complete examples</code></pre>
              </div>
              <div class="tab-pane" data-lang="python">
                <pre><code># Python example for {endpoint.path}
# Coming soon - check back later for complete examples</code></pre>
              </div>
              <div class="tab-pane" data-lang="go">
                <pre><code>// Go example for {endpoint.path}
// Coming soon - check back later for complete examples</code></pre>
              </div>
            </div>
          </div>
        </section>
      ))}
    </div>
  </div>

  <script>
    // Tab switching logic
    document.addEventListener('DOMContentLoaded', () => {
      const endpoints = document.querySelectorAll('.endpoint');

      endpoints.forEach(endpoint => {
        const tabButtons = endpoint.querySelectorAll('.tab-button');
        const tabPanes = endpoint.querySelectorAll('.tab-pane');

        tabButtons.forEach(button => {
          button.addEventListener('click', () => {
            const lang = button.getAttribute('data-lang');

            // Update active states
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));

            button.classList.add('active');
            const targetPane = endpoint.querySelector(`.tab-pane[data-lang="${lang}"]`);
            if (targetPane) {
              targetPane.classList.add('active');
            }
          });
        });
      });
    });
  </script>

  <style>
    .api-header {
      text-align: center;
      margin-bottom: 60px;
      padding-top: 40px;
    }

    .api-subtitle {
      font-size: 18px;
      color: var(--text-secondary);
      margin-top: 16px;
    }

    .api-intro {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .base-url {
      font-size: 16px;
      display: block;
      margin-top: 12px;
      padding: 12px 16px;
      background: var(--bg-elevated);
      border-radius: 6px;
    }

    .endpoints {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .endpoint {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 32px;
      scroll-margin-top: 100px;
    }

    .endpoint-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }

    .method-badge {
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid;
      letter-spacing: 0.5px;
    }

    .endpoint-path {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .endpoint-summary {
      font-size: 16px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .endpoint-description {
      color: var(--text-secondary);
      margin-bottom: 24px;
      line-height: 1.7;
    }

    .code-examples {
      margin-top: 32px;
    }

    .code-examples h3 {
      font-size: 18px;
      margin-bottom: 16px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .tab-button {
      padding: 10px 20px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-secondary);
      font-family: var(--font-mono);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tab-button:hover {
      color: var(--text-primary);
    }

    .tab-button.active {
      color: var(--accent-client);
      border-bottom-color: var(--accent-client);
    }

    .tab-content {
      position: relative;
    }

    .tab-pane {
      display: none;
    }

    .tab-pane.active {
      display: block;
    }

    .tab-pane pre {
      margin: 0;
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
    }

    @media (max-width: 768px) {
      .endpoint {
        padding: 24px 20px;
      }

      .endpoint-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</BaseLayout>
